nextflow_process {
  name 'Test process DNDSCV'
  script "modules/local/dndscv/main.nf"
  process 'DNDSCV'
  
  test("Should run without failures") {
    when {
      process {
        """
        meta = [
            id : "MSeq_Set06_Set6_42",
            dataset : "MSeq",
            patient : "Set06",
            tumour_sample: "Set6_42",
            normal_sample: "54_N",
            cancer_type: "PANCANCER" 
        ]
        snv_rds = file(params.testdata_base_path + '/DRIVER_ANNOTATION/DNDSCV/VCF.rds', checkIfExists: true)
        driver_list = file(params.testdata_base_path + '/DRIVER_ANNOTATION/DNDSCV/driver_list.txt', checkIfExists: true)
        reference = file(params.testdata_base_path + '/DRIVER_ANNOTATION/DNDSCV/RefCDS_human_GRCh37_dNdScv.0.1.0.rda', checkIfExists: true)

        input[0] = tuple(meta, snv_rds, driver_list, reference)
        """            
      }
    }

    then {
      assertAll(
        { assert process.success },
        { assert process.out.dnds_rds },
        { assert process.out.dnds_rds.size() == 1 },
        { assert process.out.dnds_rds.get(0).get(1) ==~ ".*/MSeq_Set06_Set6_42_dnds.rds" },
        { assert snapshot(process.out).match() }
      )      
    }
  }
}
