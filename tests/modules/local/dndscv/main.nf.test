nextflow_process {
  name 'Test process DNDSCV'
  script "modules/local/dndscv/main.nf"
  process 'DNDSCV'
  
  test("Should run without failures") {
    when {
      process {
        """
        meta = [
            id : "idProva",
            tumour_sample: "Set6_42",
            cancer_type: "PANCANCER" 
        ]
        snv_rds = file(params.testdata_base_path + '/DRIVER_ANNOTATION/DNDSCV/VCF.rds', checkIfExists: true)
        driver_list = file(params.testdata_base_path + '/DRIVER_ANNOTATION/DNDSCV/driver_list.txt', checkIfExists: true)
        reference = file(params.testdata_base_path + '/DRIVER_ANNOTATION/DNDSCV/RefCDS_human_GRCh37_dNdScv.0.1.0.rda', checkIfExists: true)

        input[0] = tuple(meta, snv_rds, driver_list, reference)
        """            
      }
    }

    then {
      assertAll(
        { assert process.success },
        { assert snapshot(process.out.dnds_reference).match() }
      )      
    }
  }
}
